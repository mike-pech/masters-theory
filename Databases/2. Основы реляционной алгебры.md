# Базовые
## Объединение (UNION)

Возвращает новое множество — при этом количество столбцов должно быть одинаковое и общий домен (но не всегда общий смысл)
## Минус (EXCEPT)

Возвращает новую таблицу — данные первой таблицы - данные второй таблицы

Не одно и то же, что и `SELECT DISTINCT` — `EXCEPT` используется между `SELECT`'ами, чтобы исключить данные из первой выборки, которые есть во второй выборке
## Декартово произведение (CROSS JOIN)

Возвращает декартово произведение двух таблиц — атрибут z1–a2 ... a1–z2
## Фильтрация (WHERE)

Фильтрует данные по предикату, который либо истинный, либо ложный
## Проекция (PROJECT)

Получение ограниченной выборки колонок из таблицы
## Соединение (JOIN)

Соединяет две таблицы по предикату — выполнение условия тета — больше (или равно), меньше (или равно), равно элементов одной таблицы с элементами другой

> [!INFO] JOIN работает не только по ключам
> Это в целом соответствие предикату — например количество мест в упаковке и товар

![[Pasted image 20251006083635.png]]

![[Pasted image 20251006084457.png]]
![[Pasted image 20251006085249.png]]
Естественный (Natural JOIN) — каждый с каждым на соответствие — NULL несравниваемый, т.к. обозначает неопределённость
## Деление (—)

Для двух отношений, бинарного, и унарного, возвращает отношение, содержащее все значения атрибута бинарного отношения, которые **соответствуют всем значениям в унарном отношении** — фильтрация тех значений бинарного (два и более столбцов) отношения, которые соответствуют всем значениям унарного отношения

Непопулярная операция, которой нет во многих реализациях SQL

...но всегда можно докрутить самому!

```plsql
SELECT * FROM R 
WHERE x NOT IN ( 
       SELECT x FROM (
                      (SELECT x , y FROM (SELECT y FROM S ) AS p CROSS JOIN (SELECT DISTINCT x FROM R) AS sp)
                        EXCEPT
                       (SELECT x , y FROM R) 
                                       ) 
     AS r
); 
```

Альтернативный подход через коррелирующий подзапрос
```plsql
SELECT * FROM R AS sx
WHERE NOT EXISTS (
           (SELECT p.y FROM S AS p )
            EXCEPT
           (SELECT sp.y FROM  R AS sp WHERE sp.x = sx.x ) 
);
```
# Проблемы 

![[Pasted image 20251006090238.png]]
Порядок выполнения операций со стороны оптимизатора
## Подзапросы

Обычные подзапросы позволяют экономить ресурсы за счёт уточнения внешней выборки за счёт внутренней выборки — т.е. не вся внешняя выборка, а только та, где внутренняя выборка вернула TRUE — как бы битовая карта внешней выборки либо скаляр, если результат `MAX`/`MIN` от выборки
### Коррелирующие подзапросы

Ресурсоёмкие запросы, использующие агрегирующие функции (`SUM`, `AVG`, `COUNT`), которые выполняются динамически всякий раз, когда нужно проверить условие выборки внешнего запроса

