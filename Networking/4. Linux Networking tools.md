# IP конфигурация
## `ip` — это база
#### Общий синтаксис

```shell
$ ip OBJECT COMMAND
$ ip [options] OBJECT COMMAND
$ ip OBJECT help
```

| Object        | Abbreviated form | Purpose                                             |
| ------------- | ---------------- | --------------------------------------------------- |
| **link**      | `l`                | Network device.                                     |
| **address**   | `a` `addr`      | Protocol (IP or IPv6) address on a device.          |
| **addrlabel** | `addrl`            | Label configuration for protocol address selection. |
| **neighbour** | `n`  `neigh`     | ARP or NDISC cache entry.                           |
| **route**     | `r`                | Routing table entry.                                |
| **rule**      | `ru`               | Rule in routing policy database.                    |
| **maddress**  | `m`  `maddr`     | Multicast address.                                  |
| **mroute**    | `mr`               | Multicast routing cache entry.                      |
| **tunnel**    | `t`                | Tunnel over IP.                                     |
| **xfrm**      | `x`                | Framework for IPsec protocol.                       |
#### Применение

Добавить IP адрес интерфейсу
```shell
# ip a add {ip_addr/mask} dev {interface}
```

Удалить IP адрес интерфейса
```shell
# ip a del {ipv6_addr_OR_ipv4_addr} dev {interface} 
```

Удалить (flush) все адреса из указанной сети
```shell
# ip -s -s a f to 192.168.2.0/24
```

Включить/выключить устройство
```shell
# ip link set dev {DEVICE} {up|down}
```

Поменять параметр интерфейса
```shell
# ip link set {PROPERTY} dev {DEVICE}
```

Изменение `mtu` может помочь, если пакеты не приходят на устройство, даже если в Packet Tracer всё должно работать — `mtu` (maximum transmission unit, байты) может хватать для маленьких сообщений в протоколе SMTP, но обычные пакеты могут быть слишком тяжёлыми для `mtu`

```shell
# ip link set mtu 1500 dev eth0
```

Посмотреть кэш соседей/ARP-протокола

```shell
$ ip n[eigh] show
# Sample output
74.xx.yy.zz dev eth1 lladdr 00:30:48:yy:zz:ww REACHABLE
10.10.29.66 dev eth0 lladdr 00:30:48:c6:0a:d8 REACHABLE
74.ww.yyy.xxx dev eth1 lladdr 00:1a:30:yy:zz:ww REACHABLE
10.10.29.68 dev eth0 lladdr 00:30:48:33:bc:32 REACHABLE
74.fff.uu.cc dev eth1 lladdr 00:30:48:yy:zz:ww STALE
74.rr.ww.fff dev eth1 lladdr 00:30:48:yy:zz:ww DELAY
10.10.29.65 dev eth0 lladdr 00:1a:30:38:a8:00 REACHABLE
10.10.29.74 dev eth0 lladdr 00:30:48:8e:31:ac REACHABLE
```

Создать линк в таблице ARP

```shell
# ip neigh add {IP-HERE} lladdr {MAC/LLADDRESS} dev {DEVICE} nud {STATE}
```

Удалить линк в таблице ARP

```shell
# ip neigh del {IPAddress} dev {DEVICE}
```

Удалить линки в таблице ARP для IP-адреса

```shell
# ip -s -s n f {IPAddress}
```
## Роутинг
### Через `ip route`

Посмотреть роуты:

```shell
$ ip r
$ ip r list
$ ip route list
$ ip r list [options] ip route
```

Добавить роут:

```shell
# ip route add PREFIX via address dev interface
```

Удалить роут:

```shell
# ip route del PREFIX via address dev interface
```

Максимальный `mtu` — 1500 байт
## Траблшутинг
### Нестареющая классика 
>   Перезагрузи интерфейс. Реально.
>   Перезагрузка сбрасывает состояние системы до исходного и помогает, если на рантайме что-то вдруг пошло не так

- `ping` — пингани. То есть пошли несколько пакетов на адрес. Посмотри, доходят ли они вообще
## Глубинная отладка запросов
### `dig`

`dig` позволяет запросить информацию о записи домена в DNS. Используй, если с резолвингом имён что-то не так. Если конкретный неймсервер не дан, пробует сервера по порядку в `/etc/resolv.conf`.

Синтаксис:

```shell
$ dig [options] [domain] [record type] [DNS server]
```

Пример:

```shell
$ $ dig yandex.ru

; <<>> DiG 9.20.13 <<>> yandex.ru
;; global options: +cmd
;; Got answer:
;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 42212
;; flags: qr rd ra; QUERY: 1, ANSWER: 3, AUTHORITY: 0, ADDITIONAL: 1

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 1280
;; QUESTION SECTION:
;yandex.ru.			IN	A

;; ANSWER SECTION:
yandex.ru.		935	IN	A	77.88.55.88
yandex.ru.		935	IN	A	5.255.255.77
yandex.ru.		935	IN	A	77.88.44.55

;; Query time: 5 msec
;; SERVER: 192.168.50.1#53(192.168.50.1) (UDP)
;; WHEN: Sun Sep 28 11:16:30 MSK 2025
;; MSG SIZE  rcvd: 86
```

### `nslookup`

Аналогичная `dig` команда с поддержкой интеракивного режима запроса доменных имён.

> [!WARNING] В отличие от `dig`, `nslookup` использует внутренние библиотеки для запроса доменных имён
> Это может делать её вывод отличным от других команд и её лучше не использовать

Синтаксис:

```shell
$ nslookup [domain] [DNS server]
```
### `ss`

Команда выводит статистику по сети и является более быстрым аналогом `netstat`

Синтаксис:
```shell
$ ss [options] [filter]
```
### `traceroute`

При помощи перебежек от интерфейса к интерфейсу посылает UDP датаграмму, запаокванную в IP пакет, считывая адрес хоста, время доставки и другие данные на каждом этапе доставки вплоть до хоста назначения. Пакет отслеживается на всех хопах, даже если проходит через сервера или контейнеры во внутренней сети микросервисов.

Синтаксис:

```shell
$ traceroute [options] [host]
```

Возможно также указать версию IP (`-4` или `-6`), сетевой интерфейс (`-i`), порт (`-p`) или максимальное количество хопов (`-m`)
### `iftop`

Аналогично `top` показывает таблицу с информацией по интерфейсам в реальном времени. Требует прав `sudo`.
### `telnet`

Всё ещё используется, т.к. встроен в каждый утюг и чайник — можно использовать для незамысловатых задач по проверке портов.
## Прочее
### `curl` vs `wget`

- Для пробивания ссылки/эндпоинта используй `curl`
- Для закачиваения файлов лучше использовать `wget`
