# IP конфигурация
## `ip` — это база
#### Общий синтаксис

```shell
$ ip OBJECT COMMAND
$ ip [options] OBJECT COMMAND
$ ip OBJECT help
```

| Object        | Abbreviated form | Purpose                                             |
| ------------- | ---------------- | --------------------------------------------------- |
| **link**      | `l`                | Network device.                                     |
| **address**   | `a` `addr`      | Protocol (IP or IPv6) address on a device.          |
| **addrlabel** | `addrl`            | Label configuration for protocol address selection. |
| **neighbour** | `n`  `neigh`     | ARP or NDISC cache entry.                           |
| **route**     | `r`                | Routing table entry.                                |
| **rule**      | `ru`               | Rule in routing policy database.                    |
| **maddress**  | `m`  `maddr`     | Multicast address.                                  |
| **mroute**    | `mr`               | Multicast routing cache entry.                      |
| **tunnel**    | `t`                | Tunnel over IP.                                     |
| **xfrm**      | `x`                | Framework for IPsec protocol.                       |
#### Применение

Добавить IP адрес интерфейсу
```shell
# ip a add {ip_addr/mask} dev {interface}
```

Удалить IP адрес интерфейса
```shell
# ip a del {ipv6_addr_OR_ipv4_addr} dev {interface} 
```

Удалить (flush) все адреса из указанной сети
```shell
# ip -s -s a f to 192.168.2.0/24
```

Включить/выключить устройство
```shell
# ip link set dev {DEVICE} {up|down}
```

Поменять параметр интерфейса
```shell
# ip link set {PROPERTY} dev {DEVICE}
```

Изменение `mtu` может помочь, если пакеты не приходят на устройство, даже если в Packet Tracer всё должно работать — `mtu` (maximum transmission unit, байты) может хватать для маленьких сообщений в протоколе SMTP, но обычные пакеты могут быть слишком тяжёлыми для `mtu`

```shell
# ip link set mtu 1500 dev eth0
```

Посмотреть кэш соседей/ARP-протокола

```shell
$ ip n[eigh] show
# Sample output
74.xx.yy.zz dev eth1 lladdr 00:30:48:yy:zz:ww REACHABLE
10.10.29.66 dev eth0 lladdr 00:30:48:c6:0a:d8 REACHABLE
74.ww.yyy.xxx dev eth1 lladdr 00:1a:30:yy:zz:ww REACHABLE
10.10.29.68 dev eth0 lladdr 00:30:48:33:bc:32 REACHABLE
74.fff.uu.cc dev eth1 lladdr 00:30:48:yy:zz:ww STALE
74.rr.ww.fff dev eth1 lladdr 00:30:48:yy:zz:ww DELAY
10.10.29.65 dev eth0 lladdr 00:1a:30:38:a8:00 REACHABLE
10.10.29.74 dev eth0 lladdr 00:30:48:8e:31:ac REACHABLE
```

Создать линк в таблице ARP

```shell
# ip neigh add {IP-HERE} lladdr {MAC/LLADDRESS} dev {DEVICE} nud {STATE}
```

Удалить линк в таблице ARP

```shell
# ip neigh del {IPAddress} dev {DEVICE}
```

Удалить линки в таблице ARP для IP-адреса

```shell
# ip -s -s n f {IPAddress}
```
## Роутинг
### Через `ip route`

Посмотреть роуты:

```shell
$ ip r
$ ip r list
$ ip route list
$ ip r list [options] ip route
```

Добавить роут:

```shell
# ip route add PREFIX via address dev interface
```

Удалить роут:

```shell
# ip route del PREFIX via address dev interface
```

Максимальный `mtu` — 1500 байт
## Траблшутинг
### Нестареющая классика 
>   Перезагрузи интерфейс. Реально.
>   Перезагрузка сбрасывает состояние системы до исходного и помогает, если на рантайме что-то вдруг пошло не так

- `ping` — пингани. То есть пошли несколько пакетов на адрес. Посмотри, доходят ли они вообще
## Глубинная отладка запросов
### `dig`
TODO!
