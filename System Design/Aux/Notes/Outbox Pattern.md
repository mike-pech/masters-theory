# Паттерн Outbox

> Представляет собой брокер сообщений с внешним хранилищем для синхронизации состояния системы и служит для приближения обеспечения гарантии доставки «точно 1 раз» (exactly once)
## Реализация

Часто представляет собой кластер Kafka, который подсоединён к базе данных сервиса. При получении запроса от другого сервиса на запись/изменение/удаление данных с БД сервиса, изменение в данные в виде _атомарной_ транзакции записывается как в целевую таблицу, так и таблицу Outbox, после чего считывается внешним клиентом (например Debezium) как очередь сообщений, которую обрабатыват брокер
## Зачем?

Да, Kafka — это лог, из которого можно годами не чистить события, но он гарантирует идемпотентную обработку сообщений только внутри себя и работает очень просто — по оффсету. Поэтому, в случае сбоя, при перезагрузке Kafka может рассинхронизироваться с базой данных, так как у него нет точных данных о времени изменений
